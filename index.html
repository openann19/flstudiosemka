<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FL STUDIO</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽµ</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="root"></div>
    <div class="app" style="display: none;">
        <!-- Main Toolbar -->
        <header class="header">
            <div class="brand">FL STUDIO 21</div>
            <div class="file-menu">
                <button class="menu-btn" id="save-btn">Save</button>
                <button class="menu-btn" id="export-btn">Export Project</button>
                <button class="menu-btn" id="export-audio-btn" title="Export Audio (WAV)">Export Audio</button>
                <label class="menu-btn" for="import-input">Import</label>
                <input type="file" id="import-input" accept=".flp,.json">
                <label class="menu-btn" for="load-sample-input" title="Load Audio Sample">Load Sample</label>
                <input type="file" id="load-sample-input" accept=".wav,.mp3,.ogg,.flac,.aiff" style="display:none">
            </div>
            <div class="view-tabs">
                <button class="view-tab" data-view="browser">BROWSER</button>
                <button class="view-tab" data-view="mixer">MIXER</button>
                <button class="view-tab active" data-view="channel-rack">CHANNEL RACK</button>
                <button class="view-tab" data-view="playlist">PLAYLIST</button>
                <button class="view-tab" data-view="pattern">PIANO ROLL</button>
                <button class="view-tab" data-view="effects">EFFECTS</button>
            </div>
            <input type="file" id="import-input" accept=".flp,.json" style="display: none;">
        </header>

        <!-- Transport Controls -->
        <div class="transport fl-panel">
            <div class="transport-controls">
                <button class="transport-btn" id="stop-btn" title="Stop">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="6" width="12" height="12" rx="2"/>
                    </svg>
                </button>
                <button class="transport-btn" id="play-btn" title="Play">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="8,6 18,12 8,18"/>
                    </svg>
                </button>
                <button class="transport-btn" id="record-btn" title="Record">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="8"/>
                        <circle cx="12" cy="12" r="3" fill="#ff4444"/>
                    </svg>
                </button>
                <button class="transport-btn" id="test-sound-btn" title="Test Sound">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="11,5 16,9 16,15 11,19"/>
                        <path d="M5.5 12L8.5 12"/>
                        <path d="M2 9L5 9"/>
                        <path d="M2 15L5 15"/>
                    </svg>
                </button>
            </div>
                <div class="transport-info">
                <div class="bpm-control">
                    <span class="label">TEMPO</span>
                    <button class="spinner-btn" id="bpm-down">âˆ’</button>
                    <input type="number" id="bpm-input" value="140" min="60" max="999" aria-label="BPM value">
                    <button class="spinner-btn" id="bpm-up">+</button>
                </div>
                <div class="pattern-selector">
                    <span class="label">PAT</span>
                    <select id="pattern-select" aria-label="Pattern selector">
                        <option value="1">1 - Pattern 1</option>
                    </select>
                </div>
                <div class="time-display" id="time-display">00:00:00</div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Browser Panel -->
            <div class="panel browser-panel" id="browser-panel">
                <div class="browser-header">
                    <div class="browser-tabs">
                        <button class="browser-tab active" data-category="presets">Presets</button>
                        <button class="browser-tab" data-category="samples">Samples</button>
                        <button class="browser-tab" data-category="plugins">Plugins</button>
                    </div>
                    <div class="search-box">
                        <input type="text" id="browser-search" placeholder="Search sounds...">
                    </div>
                </div>
                <div class="browser-content">
                    <div class="browser-tree">
                        <div class="tree-category" data-category="presets">
                            <div class="category-header">Presets</div>
                            <div class="category-content">
                                <div class="tree-item" data-type="folder" data-name="Drums">Drums</div>
                                <div class="tree-item" data-type="folder" data-name="Synths">Synths</div>
                                <div class="tree-item" data-type="folder" data-name="Effects">Effects</div>
                            </div>
                        </div>
                        <div class="tree-category" data-category="samples">
                            <div class="category-header">Samples</div>
                            <div class="category-content">
                                <div class="tree-item" data-type="folder" data-name="Kicks">Kicks</div>
                                <div class="tree-item" data-type="folder" data-name="Snares">Snares</div>
                                <div class="tree-item" data-type="folder" data-name="HiHats">Hi-Hats</div>
                            </div>
                        </div>
                        <div class="tree-category" data-category="plugins">
                            <div class="category-header">Plugins</div>
                            <div class="category-content">
                                <div class="tree-item" data-type="plugin" data-name="Fruity Reverb">Fruity Reverb</div>
                                <div class="tree-item" data-type="plugin" data-name="EQ">EQ</div>
                                <div class="tree-item" data-type="plugin" data-name="Compressor">Compressor</div>
                            </div>
                        </div>
                    </div>
                    <div class="browser-detail">
                        <div class="detail-header">Select a category to browse sounds</div>
                        <div class="sound-grid" id="sound-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Channel Rack -->
            <div class="panel channel-rack-panel" id="channel-rack-panel">
                <div class="channel-rack" id="channel-rack">
                    <!-- Tracks will be dynamically added here -->
                </div>
            </div>

            <!-- Playlist Panel -->
            <div class="panel playlist-panel" id="playlist-panel">
                <div class="timeline-header">
                    <div class="timeline-left">
                        <div class="timeline-info">
                            <span class="label">Playlist</span>
                            <span id="timeline-position">00:00:00</span>
                        </div>
                        <div class="arrangement-menu">
                            <label for="arrangement-select">Arrangement</label>
                            <select id="arrangement-select" aria-label="Arrangement menu">
                                <option value="arrangement-1">Arrangement 1</option>
                            </select>
                            <button class="arrangement-manage" id="manage-arrangements" title="Manage arrangements">â‹®</button>
                        </div>
                    </div>
                    <div class="timeline-right">
                        <div class="tools-menu" id="playlist-tools" role="toolbar" aria-label="Playlist tools">
                            <button class="tool-btn active" data-tool="draw" title="Draw (P)">Draw</button>
                            <button class="tool-btn" data-tool="paint" title="Paint (B)">Paint</button>
                            <button class="tool-btn" data-tool="delete" title="Delete (Del)">Delete</button>
                            <button class="tool-btn" data-tool="mute" title="Mute (T)">Mute</button>
                            <button class="tool-btn" data-tool="slice" title="Slice (C)">Slice</button>
                            <button class="tool-btn" data-tool="select" title="Select (E)">Select</button>
                            <button class="tool-btn" data-tool="slip" title="Slip Edit (S)">Slip</button>
                        </div>
                        <div class="snap-panel">
                            <label for="snap-select">Snap</label>
                            <select id="snap-select" aria-label="Snap resolution">
                                <option value="bar">Bar</option>
                                <option value="beat" selected>Beat</option>
                                <option value="step">Step</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                        <div class="timeline-zoom">
                            <button class="zoom-btn" id="zoom-in" title="Zoom in">+</button>
                            <button class="zoom-btn" id="zoom-out" title="Zoom out">-</button>
                        </div>
                        <div class="drum-machine-toggle">
                            <button class="tool-btn" id="toggle-drum-machine" title="Toggle drum machine panel" aria-pressed="false">Open Drum Machine</button>
                        </div>
                    </div>
                </div>
                <div class="timeline-marker-row" id="time-marker-strip" aria-label="Time markers"></div>
                <div class="playlist-timeline">
                    <div class="time-ruler" id="time-ruler" aria-label="Time ruler"></div>
                    <div class="timeline-tracks-wrapper">
                        <div class="timeline-tracks" id="timeline-tracks">
                            <!-- Timeline tracks will be populated by JS -->
                        </div>
                    </div>
                    <div class="playhead" id="playhead" aria-hidden="true">
                        <div class="playhead-head"></div>
                    </div>
                    <div class="timeline-grid-overlay" id="timeline-grid">
                        <!-- Grid lines will be drawn by JS -->
                    </div>
                </div>
            </div>

            <!-- Mixer Panel -->
            <div class="panel mixer-panel" id="mixer-panel">
                <div class="mixer-header">
                    <div class="mixer-master">
                        <div class="mixer-channel master-channel">
                            <div class="channel-name">Master</div>
                            <div class="mixer-fader" data-track="master">
                                <div class="fader-handle"></div>
                            </div>
                            <div class="mixer-controls">
                                <div class="mixer-btn active">M</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mixer-tracks" id="mixer-channels">
                    <!-- Mixer channels will be populated by JS -->
                </div>
            </div>

            <!-- Pattern Editor -->
            <div class="panel pattern-editor-panel" id="pattern-panel">
                <div class="pattern-toolbar">
                    <div class="pattern-info">
                        <span class="label">Pattern:</span>
                        <select id="pattern-editor-select" aria-label="Pattern editor selector">
                            <option value="1">01</option>
                        </select>
                    </div>
                    <div class="pattern-tools">
                        <button class="tool-btn" id="draw-tool">Draw</button>
                        <button class="tool-btn" id="erase-tool">Erase</button>
                        <button class="tool-btn" id="select-tool">Select</button>
                    </div>
                    <div class="pattern-zoom">
                        <button class="zoom-btn" id="pattern-zoom-in">+</button>
                        <button class="zoom-btn" id="pattern-zoom-out">-</button>
                    </div>
                </div>
                <div class="pattern-grid">
                    <div class="piano-roll" id="piano-roll">
                        <div class="piano-keys" id="piano-keys">
                            <!-- Piano keys will be populated by JS -->
                        </div>
                        <div class="note-grid" id="note-grid">
                            <!-- Notes will be drawn by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Master Effects Panel -->
            <div class="panel effects-panel" id="effects-panel">
                <div class="effects-header">
                    <h2>Master Effects</h2>
                </div>
                <div class="effects-chain" id="effects-chain">
                    <!-- Effects will be populated by JS -->
                </div>
            </div>
        </main>
    </div>

    <div id="drum-machine-container"></div>
    
    <!-- TypeScript modules loaded via Vite (converted modules) -->
    <!-- This imports timelineUtils and makes it available on window -->
    <script type="module" src="/src/main.ts"></script>
    
    <!-- React application entry point -->
    <script type="module" src="/src/index.tsx"></script>
    
    <!-- Legacy application modules (if needed for compatibility) -->
    <!-- <script type="module" src="/app.js"></script> -->
    
    <!-- Build verification (remove in production) -->
    <script src="build-verify.js"></script>
</body>
</html>
